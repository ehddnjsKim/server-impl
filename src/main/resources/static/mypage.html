<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆì´í˜ì´ì§€</title>
</head>
<body>
<h1>ğŸ™‹ ë‚´ ì •ë³´</h1>

<div id="userInfo">
    <p><strong>ì•„ì´ë””:</strong> <span id="username"></span></p>
    <p><strong>ì´ë©”ì¼:</strong> <span id="email"></span></p>
    <p><strong>ê°€ì…ì¼:</strong> <span id="createdAt"></span></p>
</div>

<hr>

<h3>íšŒì› ì •ë³´ ìˆ˜ì •</h3>
<form id="editForm">
    <input type="text" id="newUsername" placeholder="ìƒˆ ì•„ì´ë””" required><br>
    <input type="email" id="newEmail" placeholder="ìƒˆ ì´ë©”ì¼"><br>
    <input type="password" id="newPassword" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" required><br>
    <button type="submit">ìˆ˜ì •</button>
</form>

<p id="message"></p>
<nav style="margin-bottom: 20px;">
    <a href="index.html">ğŸ  ê²Œì‹œíŒ</a> |
    <a href="login.html" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</a>
</nav>
<script>
    // ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
    let loginUser = null;

    async function loadUser() {
        const res = await fetch("/api/users/session"); // ì„¸ì…˜ ì •ë³´ ìš”ì²­
        if (!res.ok) {
            document.getElementById("message").innerText = "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.";
            return;
        }
        loginUser = await res.json();
        document.getElementById("username").innerText = loginUser.username;
        document.getElementById("email").innerText = loginUser.email || "-";
        document.getElementById("createdAt").innerText = loginUser.createdAt?.replace("T", " ").slice(0, 16) || "-";

        // ìˆ˜ì • í¼ ê¸°ë³¸ê°’ ì„¤ì •
        document.getElementById("newUsername").value = loginUser.username;
        document.getElementById("newEmail").value = loginUser.email || "";
    }

    // ìˆ˜ì • ìš”ì²­
    document.getElementById("editForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const updatedUser = {
            username: document.getElementById("newUsername").value,
            email: document.getElementById("newEmail").value,
            password: document.getElementById("newPassword").value
        };

        const res = await fetch(`/api/users/${loginUser.id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(updatedUser)
        });

        if (res.ok) {
            alert("ìˆ˜ì • ì™„ë£Œ! ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
            window.location.href = "login.html";
        } else {
            const err = await res.text();
            document.getElementById("message").innerText = "ìˆ˜ì • ì‹¤íŒ¨: " + err;
        }
    });

    loadUser();
</script>
</body>
</html>
